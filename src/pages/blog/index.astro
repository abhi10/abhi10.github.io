---
import { getCollection } from "astro:content";
import { siteConfig } from "../../config";
import BlogHeader from "../../components/BlogHeader.astro";
import "../../styles/global.css";

const posts = (await getCollection("blog", ({ data }) => !data.draft)).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

function formatDate(date: Date): string {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={`Blog posts by ${siteConfig.name}`} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <title>Blog - {siteConfig.name}</title>
  </head>
  <body class="bg-amber-50/30">
    <BlogHeader currentPath="/blog" />

    <main class="max-w-4xl mx-auto px-6 sm:px-8 py-16 sm:py-20">
      <div class="mb-14">
        <h1
          class="text-4xl sm:text-5xl md:text-6xl font-bold text-gray-800 mb-4"
        >
          Blog
        </h1>
        <div
          class="w-20 h-1 rounded-full"
          style={`background-color: ${siteConfig.accentColor}`}
        >
        </div>
        <p class="mt-6 text-lg text-gray-600">
          Thoughts on testing, automation, and software quality.
        </p>
      </div>

      {
        posts.length === 0 ? (
          <p class="text-gray-500 text-lg">No posts yet. Check back soon!</p>
        ) : (
          <div class="space-y-8">
            {posts.map((post) => (
              <a
                href={`/blog/${post.id}`}
                class="group block relative p-6 sm:p-8 bg-white rounded-2xl border border-amber-100 transition-all duration-300 hover:shadow-lg hover:border-amber-200 hover:-translate-y-1"
              >
                <div
                  class="absolute top-6 right-6 sm:top-8 sm:right-8 w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center rounded-full text-white transition-all duration-300"
                  style={`background-color: ${siteConfig.accentColor}`}
                >
                  <svg
                    class="w-4 h-4 sm:w-4.5 sm:h-4.5 transition-transform duration-300 group-hover:translate-x-0.5 group-hover:-translate-y-0.5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 17L17 7M17 7H7M17 7V17"
                    />
                  </svg>
                </div>

                <div class="space-y-4 pr-16">
                  <div>
                    <time
                      datetime={post.data.pubDate.toISOString()}
                      class="text-sm font-mono"
                      style={{ color: siteConfig.accentColor }}
                    >
                      {formatDate(post.data.pubDate)}
                    </time>
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mt-2">
                      {post.data.title}
                    </h2>
                  </div>

                  <p class="text-base sm:text-lg text-gray-600 leading-relaxed">
                    {post.data.description}
                  </p>

                  {post.data.tags && post.data.tags.length > 0 && (
                    <div class="flex flex-wrap gap-2 pt-2">
                      {post.data.tags.map((tag) => (
                        <span
                          class="px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium"
                          style={`background-color: ${siteConfig.accentColor}15; color: ${siteConfig.accentColor}`}
                        >
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
              </a>
            ))}
          </div>
        )
      }
    </main>

    <footer class="border-t border-amber-200/50 p-8 sm:p-10 mt-12 bg-white/50">
      <div class="max-w-4xl mx-auto text-center text-amber-700 text-sm">
        &copy; {new Date().getFullYear()}
        {siteConfig.name}. All rights reserved.
      </div>
    </footer>
  </body>
</html>
